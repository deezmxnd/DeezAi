from transformers import pipeline
import textwrap

print("=== Deez Ai V1.0 ===")
print("Paste your essay/article. When finished, press Enter twice to end input.\n")

summarizer = pipeline("summarization", model="sshleifer/distilbart-cnn-12-6", device=-1)

def smart_chunk_text(text, max_words=500):
    """Split text into chunks by paragraphs or max_words limit."""
    paragraphs = text.split("\n\n")
    chunks = []
    current_chunk = ""
    
    for para in paragraphs:
        if len((current_chunk + para).split()) <= max_words:
            current_chunk += para + "\n\n"
        else:
            if current_chunk:
                chunks.append(current_chunk.strip())
            # If paragraph is too big, split by words
            words = para.split()
            for i in range(0, len(words), max_words):
                chunks.append(" ".join(words[i:i+max_words]))
            current_chunk = ""
    if current_chunk:
        chunks.append(current_chunk.strip())
    return chunks

def summarize_text(text):
    chunks = smart_chunk_text(text, max_words=500)
    full_summary = []
    for chunk in chunks:
        summary = summarizer(
            chunk,
            max_length=200,
            min_length=50,
            do_sample=False
        )
        full_summary.append(summary[0]['summary_text'])
    return " ".join(full_summary)

lines = []
while True:
    line = input()
    if line == "":
        # Double Enter ends input
        if lines and lines[-1] == "":
            break
    lines.append(line)

text = "\n".join(lines).strip()
if text:
    print("\nSummarizing...")
    try:
        final_summary = summarize_text(text)
        print("\n=== Final Summary ===")
        print(final_summary)
    except Exception as e:
        print(f"Error during summarization: {e}")


input("\nPress Enter to exit...")
